# 블록체인 구현

## 블록체인이란?

이전 블록의 해시 값이 현재 생성하는 블록의 해시 값에 영향을 미치는 연결 리스트이다. 중간의 블록 값이 바뀌면 그 이후의 블록들에 모두 영향이 가기 때문에 변조를 하려면 그 이후의 모든 블록을 조작해야 하므로 변조가 어렵다. 정보를 분산하여 저장하기때문에 데이터 유실을 방지할 수 있다.

주로 해싱 알고리즘은 sha256을 사용한다. 하지만 sha256은 현재 쉽게 해독할 수 있기 때문에 특별한 과제를 부여하여 새로운 노드 생성에 시간을 지연시킨다. 현재 노드의 해시 값은 이전 노드의 해시값과 현재 데이터에 영향을 받는데 여기에 영향을 받는 변수 nonce를 추가한다. nonce는 0에서 시작해서 점점 커지는 방식으로 사용하고, 이렇게 만들어진 해시 값이 내가 원하는 형태가 될 때의 nonce값을 채택하는 방식으로 동작한다.



## 내가 원하는 블록체인의 구현

### 요구사항

해시 값이 00000으로 시작하는 블록체인을 구성하고자 한다.

block 클래스는 생성자에 이전의 해시 데이터와 현재 저장하고자 하는 데이터를 추가한다.

hash값이 원하는 형태가 될 때까지 nonce를 1씩 더하면서 시도해 본다.

이렇게 들어온 데이터에 의하여 nonce와 hash값이 생성된다.

블록 클래스 정의

```python
class block():
    def __init__(self, a, b):
        self.prev = a
        self.data = str(b)

        temp = self.prev + self.data
        nonce = 0
        while 1:
            sha.update((temp + str(nonce)).encode('utf-8'))
            temp2 = sha.hexdigest()
            if temp2[:5] == '00000':
                break
            nonce += 1
        self.nonce = nonce
        self.hash = temp2
```

sha 객체를 갱신하기 위하여 넣어줄 데이터를 스트링으로 변경하고 인코딩을 해서 sha객체에 넣어준다.

sha 객체에서 생성한 해시값을 temp2로 받는다.

temp2가 원하는 형태가 되었는지 확인하고 원하는 형태가 되면 break한다. 원하는 형태가 아니면 nonce를 1씩 더하면서 다시 시도한다.



## 결과

```
nonce: 1531804
data: initial
prevhash: initial
hash: 00000e357a766e815dc508d05bd05561ec7668238016f677dcff953bf12834dc

nonce: 35761
data: 1
prevhash: 00000e357a766e815dc508d05bd05561ec7668238016f677dcff953bf12834dc
hash: 000001c5f369495a7c9796dd11985410e0ef84383060bf99ee84eeebf6d106de

nonce: 88148
data: 2
prevhash: 000001c5f369495a7c9796dd11985410e0ef84383060bf99ee84eeebf6d106de
hash: 00000dc47e4b9788fb29d4a80cb30788efae6cbd0530016c55d7f02e581082c1

nonce: 527357
data: 3
prevhash: 00000dc47e4b9788fb29d4a80cb30788efae6cbd0530016c55d7f02e581082c1
hash: 00000e331c4fc8df32c00975c696cdcd43fe92b685d74e3e5866cadc188cb4e3
```



## 해시를 활용하는 사례

해시는 다양한 방법으로 활용되는데 그 중 하나가 자료 저장 구조이다.

해시 값을 키 값으로 가지는 데이터 저장 구조를 만들어서 키 값을 대입하면 바로 해당하는 값이 나오는 형식으로 자료를 보관하는데 이것이 바로 NoSQL에 해당한다. 장점은 탐색을 해서 값을 가져오는 것이 아니라 키값을 넣으면 바로 값을 얻을 수 있어, 키 값을 알 경우 빠른 속도로 데이터를 얻을 수 있다는 것이다.

그 다음으로는 보안쪽에서의 해시 사용이다.

해시의 특징은 해쉬화한 데이터를 원래의 데이터로 복원할 수 없다. 데이터의 손실이 일어나기 때문이다. 거기에 원래 데이터의 일부만 바뀌더라도 해시값은 전혀 다르게 된다. 따라서 비밀번호 등을 암호화 하는데 사용되기도 한다.

그 외로는 파일의 무결성 증명이다.

해시코드는 원본 데이터의 일부가 바뀌더라도 완전히 바뀌는 특징이 있기 때문에, 원래 데이터에 조작이 가해졌으면 해시값이 확연히 다르게 된다. 그래서 파일을 조작한다면 해시코드값이 달라지게 되고 그러면 조작이 가해졌다는 사실을 알 수 있다. 손쉽게 파일의 무결성을 증명할 수 있다.



이처럼 다양한 분야에서 다양한 방법으로 해싱이 이용되고 있다는 것을 알게 되었으며, 이러한 것들을 염두에 두고 다른 방법으로도 활용할 수 있는 방법을 구상하고 적용할 수 있다면 더할나위 없을 것이다.