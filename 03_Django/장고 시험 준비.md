# 장고 시험 준비

## Django 웹 프레임워크

#### admin 페이지

```python
from django.contrib import admin
from .models import Article
class ArticleAdmin(admin.ModelAdmin):
    list_display = ['id', 'title', 'content', 'created_at', 'updated_at']

admin.site.register(Article, ArticleAdmin)
```

USE_I18N 현재 랭기지 코드에 맞는 번역 기계

USE_L10N 현재 랭기지 코드에 맞는 숫자, 날짜 형식

USE_TZ 현재 랭키지 코드에 맞는 데이터베이스 기록 true면 글로벌시간 기준으로 false면 현지 기준으로 저장하고 읽어올 때도 마찬가지.



#### 부트스트랩

부트스트랩 자동으로 입히기 위해서는 django-bootstrap4를 설치하고

설치 앱에 bootstrap4를 추가

html 문서 파일에서 {% load bootstrap4 %}

헤드태그에 {% bootstrap_css %} 추가

```html
{% load bootstrap4 %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    {% bootstrap_css %}
    <title>Document</title>
</head>
<body>
    {% block body %}
    {% endblock %}
</body>
</html>
```



부트스트랩을 스태틱 활용해서 적용하는 방법

앱 폴더 안에 static폴더를 만들고 다운받은 파일의 압축을 푼다.

settings.py에 STATIC_ROOT = os.path.join(BASE_DIR, 'static')

스타일 시트 링크의 주소를 href='{% static "css/bootstrap.min.css" %}'로 작성한다.





#### 템플릿 필터 만들기

templatetags폴더에 내가 원하는 파일명을 가진 py파일과 init파일을 작성한다.

```python
from django import template

register = template.Library()

@register.filter
def makemd5(인풋):
    return  반환할 결과
```

이렇게 만들면 html문서에서

{% load 파일명 %}

{% 인풋|함수명 %} 이렇게 활용 가능하다.









## MTV 아키텍처



## Template/View 기초

### URL 앱별로 관리하는 방법

먼저 프로젝트를 만들어야 한다.



기본 준비

프로젝트 만들기 위해서 pip install django로 장고를 설치해 준다.

내가 만들 프로젝트와 앱들을 담을 폴더를 만들고

그 경로에서 python -m venv venv 명령어를 입력해 가상환경을 설정한다.

source venv/Scripts/activate 명령을 입력해 가상환경을 실행한 후

pip install django 명령을 입력해 장고를 설치한다.

django-admin startproject 프로젝트폴더명 .

폴더명 뒤에 . 을 붙여줘야 현재 위치에 프로젝트폴더를 만들어 준다.

python manage.py startapp articles 프로젝트를 만들고 나선 앱을 만든다

앱을 만들고 나선 프로젝트 폴더 안의 settings.py에 INSTALLED_APPS에 앱 이름을 추가해 준다.

프로젝트 폴더의 urls.py에 include를 import 해 주고 앱 url 추가해주기

```python
from django.urls import path, include
```



프로젝트 폴더에 templates폴더를 만들고 base.html 만들고

settings의 TEMPLATES의 DIRS에 os.path.join(BASE_DIR, 'crud', 'templates') 추가

base에 모든 동적인것 가져오고

{% block body %}

{% endblock %}

블락을 만들어 확장할 때 쓸 수 있게 한다.



앱 폴더 내에 templates를 만들고

그 안에 앱 이름으로 폴더를 다시 만들어 준다.

그렇게 하는 이유는 장고에서 모든 앱들을 찾아 보면서 templates 안에 존재하는 파일을 찾는데

앱에서 이름이 겹칠 경우 먼저 만난 앱의 html파일을 가져오기 때문이다.

앱의 html파일에선 

{% extends 'base.html' %}

{% block body %}



{% endblock %}

이렇게 기본적으로 만들어 준 후 블락 안에 원하는 내용들을 작성하면 된다.



#### 세션에 데이터 추가

```python

    # 1. 세션 정보에서 visits_num 이라는 키로 접근해 값을 가져옴
    # 해당하는 키가 없으면 0 을 가져옴
    visits_num = request.session.get('visits_num', 0)

    # 2. 가져온 값을 session에 'visits_num'이라는 새로운 키의 값으로 1씩 증가
    request.session['visits_num'] = visits_num+1

    # 3. 세션 데이타를 수정하면 장고는 수정한 내용을 알 수 없어서 작성하는 코드
    request.session.modified = True
```

이렇게 하면 user 세션에



## Model 기초



## Django Form

```python
class ArticleForm(forms.ModelForm):
    title = forms.CharField(
        max_length=10,
        label='제목',
        widget=forms.TextInput(
            attrs={
                'class': 'my-title',
                'placeholder': 'Enter the title',
            }
        )
    )
    content = forms.CharField(
        label='내용',
        widget=forms.Textarea(
            attrs={
                'class': 'my-content',
                'placeholder': 'Enter the content',
                'rows': 5,
                'cols': 50,
            }

        )
    )
    class Meta:
        model = Article
        # fields = '__all__'
        fields = ('title', 'content', )
        # widgets = {
        #     'title': forms.TextInput(
        #         attrs={
        #             'class': 'my-title',
        #             'placeholder': 'Enter the title!',
        #         }
        #     )
        # }
```



초기값이 들어간 폼을 가져오려면

```python
forms = ArticleForm(initial = {
    'title': article.title,
    'content': article.content,
})
```

이렇게 직접 initial을 설정하거나

instance=article

넣어주면 된다.





## 사용자인증/권한관리

```python
from django.views.decorators.http import require_POST
from django.contrib.auth.decorators import login_required
```

데코레이터 로드

@login_required()

이러면 기본적으로 ?next=다음유알엘 이렇게 작성되며

@login_required(redirect_field_name='필드명')

이러면 필드명:다음유알엘 이런식으로 작성된다.

로그인 url이 다른 경우엔

@login_required(login_url='/accounts/login/') 이런식으로 명시적으로 써 준다.

기본값이 login_url='/accounts/login/'이다





## 파일업로드 및 정적 파일 관리

models.py에 models.ImageField(blank=True) 추가

views.py에서 image = request.FILES.get('image') 이런 방식으로 파일을 받아올 수 있다.

대신 폼태그에 enctype를 추가해야 한다.

```html
<form action="{% url 'articles:create' %}" method="POST" enctype="multipart/form-data">
```



'image'는 폼 안에 인풋이미지 이름이 image여서다.

```html
<input type="file" name="image" id="image" accept="image/*">
```

accept="image/*"는 이미지파일 전부

"audio/*"은 오디오 파일 전부

"video/*"은 비디오 파일 전부

".gif, .jpg" 이런식으로 확장자도 가능.

혹은 "audio/mpeg, image/jpeg" 등으로도 가능



settings.py

STATIC_URL과 비슷. 업로드된 파일의 주소(URL)를 만들어 줌. 실제 이미지 파일이 업로드 된 디렉토리는 아님

MEDIA_URL = '/media/'

사용자가 업로드한 이미지 파일의 저장 위치. 업로드가 끝난 이미지 파일을 위치 시킬 최상위 경로

MEDIA_ROOT = os.path.join(BASE_DIR, 'media')



urls.py

파일이 업로드 된 이후에 프로젝트 내부에 존재하는 파일의 주소를 만들어 줌

urlpatterns += static(settings.MEDIA_URL, document_root=settings.MEDIA_ROOT)





스태틱 관리



```html
# 웹 페이지에서 사용할 정적 파일의 최상위 URL 경로(실제 파일이 위치한 디렉토리는 아님)
STATIC_URL = '/static/'

# 정적 파일이 실제 위치한 경로 (crud/assets)
STATICFILES_DIRS = [
    os.path.join(BASE_DIR, 'crud', 'assets'),
]
```



crud/assets/images/Hangul.png 파일을 불러오는 방법

```html
<img src="{% static 'images/Hangul.png' %}" alt="이미지">
```



articles/static/articles/images 폴더의 1.png파일을 불러오는 방법

```html
{% load static %}
    <img src="{% static 'articles/images/1.png' %}" alt="이미지파일">
```







ALLOWED_HOSTS

form.cleaned_data.get('title')

STATICFILES_DIRS = [os.path.join(),]

MEDIA_ROOT = os.path.join()

MEDIA_URL = '/media/'